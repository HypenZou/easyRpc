// Copyright 2020 wubbalubbaaa. All rights reserved.
// Use of this source code is governed by an MIT-style
// license that can be found in the LICENSE file.

package easyRpc

import (
	"fmt"
	"log"
)

// DefaultLogger instance
var DefaultLogger Logger = &logger{level: LogLevelInfo}

const (
	// LogLevelAll .
	LogLevelAll = iota
	// LogLevelDebug .
	LogLevelDebug
	// LogLevelInfo .
	LogLevelInfo
	// LogLevelWarn .
	LogLevelWarn
	// LogLevelError .
	LogLevelError
	// LogLevelNone .
	LogLevelNone
)

// Logger defines log interface
type Logger interface {
	SetLogLevel(lvl int)
	Debug(format string, v ...interface{})
	Info(format string, v ...interface{})
	Warn(format string, v ...interface{})
	Error(format string, v ...interface{})
}

// SetLogger set default logger for easyRpc
func SetLogger(l Logger) {
	DefaultLogger = l
}

// SetLogLevel .
func SetLogLevel(lvl int) {
	switch lvl {
	case LogLevelAll, LogLevelDebug, LogLevelInfo, LogLevelWarn, LogLevelError, LogLevelNone:
		DefaultLogger.SetLogLevel(lvl)
		break
	default:
		panic(fmt.Errorf("invalid log level: %v", lvl))
	}
}

// logger defines default logger
type logger struct {
	level int
}

// SetLogLevel .
func (l *logger) SetLogLevel(lvl int) {
	switch lvl {
	case LogLevelAll, LogLevelDebug, LogLevelInfo, LogLevelWarn, LogLevelError, LogLevelNone:
		l.level = lvl
		break
	default:
		panic(fmt.Errorf("invalid log level: %v", lvl))
	}
}

// Debug simply printf
func (l *logger) Debug(format string, v ...interface{}) {
	if LogLevelDebug >= l.level {
		log.Printf("[DBG] "+format, v...)
	}
}

// Info simply printf
func (l *logger) Info(format string, v ...interface{}) {
	if LogLevelInfo >= l.level {
		log.Printf("[INF] "+format, v...)
	}
}

// Warn simply printf
func (l *logger) Warn(format string, v ...interface{}) {
	if LogLevelWarn >= l.level {
		log.Printf("[WRN] "+format, v...)
	}
}

// Error simply printf
func (l *logger) Error(format string, v ...interface{}) {
	if LogLevelError >= l.level {
		log.Printf("[Err] "+format, v...)
	}
}

func logDebug(format string, v ...interface{}) {
	if DefaultLogger != nil {
		DefaultLogger.Debug(format, v...)
	}
}

func logInfo(format string, v ...interface{}) {
	if DefaultLogger != nil {
		DefaultLogger.Info(format, v...)
	}
}

func logWarn(format string, v ...interface{}) {
	if DefaultLogger != nil {
		DefaultLogger.Warn(format, v...)
	}
}

func logError(format string, v ...interface{}) {
	if DefaultLogger != nil {
		DefaultLogger.Error(format, v...)
	}
}
